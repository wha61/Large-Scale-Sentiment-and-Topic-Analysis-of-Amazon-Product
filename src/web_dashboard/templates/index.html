<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Reviews Analysis Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Amazon Reviews Analysis Dashboard</h1>
            <p class="subtitle">Large-Scale Sentiment and Topic Analysis of Amazon Product Reviews</p>
        </header>

        <!-- Problem Statement -->
        <div class="hero-statement">
            <div class="hero-content">
                <h2 class="hero-question">Do you really trust reviews from Amazon?</h2>
                <p class="hero-description">
                    This dashboard analyzes Amazon product reviews to identify discrepancies between user ratings and 
                    sentiment expressed in review text. We detect <strong>mismatched reviews</strong> where ratings 
                    don't align with actual sentiment, helping identify potential fake or misleading reviews.
                </p>
            </div>
            
            <!-- Interactive Review Examples -->
            <div class="review-examples-container">
                <h3 class="examples-title">Real Examples of Mismatched Reviews</h3>
                <div class="review-examples-carousel" id="reviewCarousel">
                    <!-- Review cards will be dynamically generated here -->
                </div>
                
                <div class="carousel-controls">
                    <button class="carousel-btn prev-btn" onclick="changeReviewExample(-1)">← Previous</button>
                    <div class="carousel-dots" id="carouselDots">
                        <!-- Dots will be dynamically generated here -->
                    </div>
                    <button class="carousel-btn next-btn" onclick="changeReviewExample(1)">Next →</button>
                </div>
            </div>
        </div>

        <!-- Statistics Overview -->
        <section class="stats-section">
            <h2>Overview Statistics</h2>
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card" onclick="showStatDetails('total')">
                    <div class="stat-value" id="totalRatings">-</div>
                    <div class="stat-label">Total Reviews</div>
                    <div class="stat-description">Total number of reviews analyzed in the dataset</div>
                </div>
                <div class="stat-card" onclick="showStatDetails('mismatched')">
                    <div class="stat-value" id="mismatchedCount">-</div>
                    <div class="stat-label">Mismatched Reviews</div>
                    <div class="stat-description">Reviews where user rating differs significantly from sentiment analysis</div>
                </div>
                <div class="stat-card" onclick="showStatDetails('mae')">
                    <div class="stat-value" id="avgMAE">-</div>
                    <div class="stat-label">Average MAE</div>
                    <div class="stat-description">Mean Absolute Error: Average difference between user ratings and AI sentiment scores</div>
                </div>
            </div>
        </section>

        <!-- Data Processing Scale Statistics -->
        <section class="chart-section">
            <h2>Data Processing Scale Statistics</h2>
            <div class="info-box">
                <p>
                    This panel shows the scale of data processing across different stages of the pipeline: 
                    <strong>Raw Data</strong> → <strong>Cleaned Data</strong>. 
                    The pipeline uses Apache Spark for distributed big data processing, handling millions of 
                    reviews efficiently.
                </p>
            </div>
            
            <div class="stats-grid" id="processingStatsGrid">
                <div class="stat-card">
                    <div class="stat-label">Raw Data</div>
                    <div class="stat-value" id="rawCount">-</div>
                    <div class="stat-description">Total records in raw dataset</div>
                    <div class="stat-meta">
                        <span>Size: <span id="rawSize">-</span> MB</span>
                        <span>Partitions: <span id="rawPartitions">-</span></span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Cleaned Data</div>
                    <div class="stat-value" id="cleanedCount">-</div>
                    <div class="stat-description">Records after ETL processing</div>
                    <div class="stat-meta">
                        <span>Size: <span id="cleanedSize">-</span> MB</span>
                        <span>Partitions: <span id="cleanedPartitions">-</span></span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Data Retention</div>
                    <div class="stat-value" id="retentionRate">-</div>
                    <div class="stat-description">Percentage of data retained after cleaning</div>
                    <div class="stat-meta">
                        <span>Reduction: <span id="dataReduction">-</span>%</span>
                    </div>
                </div>
            </div>

            <div class="chart-container" style="margin-top: 30px;">
                <canvas id="dataProcessingChart"></canvas>
            </div>

            <div class="stats-grid" style="margin-top: 30px;">
                <div class="stat-card">
                    <div class="stat-label">Spark Configuration</div>
                    <div class="stat-description" style="text-align: left; padding: 10px;">
                        <div><strong>App Name:</strong> <span id="sparkAppName">-</span></div>
                        <div><strong>Spark Version:</strong> <span id="sparkVersion">-</span></div>
                        <div><strong>Default Parallelism:</strong> <span id="sparkParallelism">-</span></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Data Quality Metrics</div>
                    <div class="stat-description" style="text-align: left; padding: 10px;">
                        <div><strong>Completeness:</strong> <span id="dataCompleteness">-</span>%</div>
                        <div><strong>Null Text Fields:</strong> <span id="nullText">-</span></div>
                        <div><strong>Null Ratings:</strong> <span id="nullRating">-</span></div>
                        <div><strong>Null Sentiment:</strong> <span id="nullSentiment">-</span></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Rating vs Sentiment Analysis -->
        <section class="chart-section">
            <h2>Rating vs Sentiment Analysis</h2>
            <div class="chart-container">
                <canvas id="ratingVsSentimentChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="ratingDistributionChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="maeByRatingChart"></canvas>
            </div>
        </section>

        <!-- Mismatched Reviews -->
        <section class="chart-section">
            <h2>Mismatched Reviews Analysis</h2>
            <div class="info-box">
                <h4>Core Problem: Rating vs Sentiment Mismatch</h4>
                <p>
                    This section identifies reviews where user ratings (1-5 stars) significantly differ from 
                    AI-generated sentiment scores. These mismatches reveal potential issues such as:
                    <strong>fake reviews</strong>, <strong>misleading ratings</strong>, or cases where users 
                    express negative sentiment but give high ratings (or vice versa).
                </p>
                <p style="margin-top: 8px; font-style: italic; color: #4a5568;">
                    Example: A review with "I've never eaten anything so awful" but rated 5 stars.
                </p>
            </div>
            <div class="chart-container">
                <canvas id="mismatchDistributionChart"></canvas>
            </div>
            <div class="info-box" style="margin-top: 20px; margin-bottom: 20px;">
                <h4>Understanding Sentiment Confidence</h4>
                <p>
                    The sentiment analysis uses the <strong>nlptown/bert-base-multilingual-uncased-sentiment</strong> model, 
                    which outputs two values for each review:
                </p>
                <ul style="margin-top: 10px; margin-bottom: 10px; padding-left: 25px; line-height: 1.8;">
                    <li><strong>sentiment_star</strong>: Sentiment score on a 1-5 star scale</li>
                    <li><strong>sentiment_conf</strong>: Confidence score ranging from 0.0 to 1.0</li>
                </ul>
                <p style="margin-top: 10px;">
                    The confidence score represents the model's certainty in its prediction. Higher values indicate 
                    greater confidence:
                </p>
                <ul style="margin-top: 10px; margin-bottom: 10px; padding-left: 25px; line-height: 1.8;">
                    <li><strong>0.8-1.0</strong>: High confidence - model is very certain</li>
                    <li><strong>0.6-0.8</strong>: Moderate confidence - reasonably certain</li>
                    <li><strong>0.4-0.6</strong>: Low confidence - somewhat uncertain</li>
                    <li><strong>0.0-0.4</strong>: Very low confidence - model is uncertain</li>
                </ul>
                <p style="margin-top: 10px; font-size: 0.9em; color: #718096;">
                    The confidence score helps identify reviews where the sentiment prediction may be less reliable, 
                    particularly useful when analyzing mismatched reviews.
                </p>
            </div>
            <div class="table-container">
                <h3>Sample Mismatched Reviews</h3>
                <div class="search-box">
                    <input type="text" id="reviewSearch" placeholder="Search by rating, sentiment, difference, or review text...">
                </div>
                <table id="reviewsTable">
                    <thead>
                        <tr>
                            <th>Rating</th>
                            <th>Sentiment</th>
                            <th>Confidence</th>
                            <th>Difference</th>
                            <th>Review Text</th>
                        </tr>
                    </thead>
                    <tbody id="reviewsTableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Macro Correlation -->
        <section class="image-section">
            <h2>Macro-Economic Correlation</h2>
            <div class="info-box">
                <h4>Macro-Level Analysis</h4>
                <p>
                    This visualization correlates aggregated consumer sentiment trends with external economic 
                    indicators (US Inflation Rate from World Bank). It explores whether consumer emotions 
                    expressed in product reviews show meaningful correlations with broader economic conditions.
                </p>
            </div>
        </section>

        <!-- Temporal Trends -->
        <section class="chart-section">
            <h2>Sentiment, Rating, and Inflation Trends</h2>
            <div class="chart-container">
                <canvas id="yearlyTrendChart"></canvas>
            </div>
            <div class="table-container" style="margin-top: 30px;">
                <h3>Yearly Statistics: Sentiment, Rating, and Inflation</h3>
                <table id="yearlyStatsTable">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Average Sentiment</th>
                            <th>Average Rating</th>
                            <th>Inflation Rate (%)</th>
                            <th>Review Count</th>
                        </tr>
                    </thead>
                    <tbody id="yearlyStatsTableBody">
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Modal for Stat Details -->
    <div id="statModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Statistic Details</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
